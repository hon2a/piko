var Base = require('ActionSet'),
	fn = require('functions');

// actions are executed in a sequence, error means the end of execution
var ActionSequence = module.exports = ActionSet.extend({

	// protected override
	runActions: function (args, callback) {
		var results = [],
			index = 0,
			count = this.actions.length,
			next = fn.proxy(function (err) {
				if (err || (index >= count)) {
					callback(err, results);
				} else {
					var actionArgs = args.concat(this.arguments[index], [function (err) {
						results.push(fn.array(arguments, 1));
						next(err);
					}]);
					this.actions[index++].apply(module, actionArgs);
				}
			}, this);
		next();
	}
	
});