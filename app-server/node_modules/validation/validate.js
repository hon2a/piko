var validators = require('./validators'),
	util = require('util'),
	fn = require('functions');

/**
 * @param {Array/String/RegExp} config depending on type:
 *		String: ID of argument-less validator,
 *		Array: ID of validator and arguments to be passed to it,
 *		RegExp: regular expression to match the value against
 *	@param {Object} value
 *	@param {Function} callback
 * @return {String} validation error message or null if valid
 */
var validate = module.exports = function (config, value, callback) {
	var result = true;
	if (config) {
		config = fn.isString(config) ? [config] : config;
		if (fn.isArray(config)) {
			var name = config[0];
			if (validators[name]) {
				validators[name].apply(module, [value].concat(config.slice(1)));
			} else {
				result = util.format('Validator %s not found.', fn.quote(name));
			}
		} else if (util.isRegExp(config)) {
			result = config.test(value) ||
					util.format('Value does not match expression %s.', config);
		}
	}

	result = (result === false) ?
		util.format('Value %s forbidden by unspecified restriction.', fn.quote(value)) :
		result;
	callback(result || null);
};