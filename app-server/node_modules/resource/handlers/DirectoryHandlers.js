var ResourceHandlers = require('./ResourceHandlers'),
	HTTP = require('http-status'),
	fs = require('fs');

var DirectoryHandlers = module.exports = ResourceHandlers.extend({

	constructor: function (config) {
		this.base(fn.merge({
			path: null	// mandatory
		}, config));
	},
	
	fillPath: function (req, callback) {
		fn.fillPathString(this.config.path, req.params, callback);
	},

// handler methods

	index: function (req, res) {
		console.log('Path: ' + this.config.path);
		console.dir(req.params);
		this.fillPath(req, function (err, path) {
			if (err) {
				res.finish(err);
			} else {
				console.log('Resolved to: ' + path);
				fs.readdir(path, function (err, files) {
					if (err && (err.code === 'ENOENT')) {
						res.send(HTTP.NOT_FOUND);
					} else {
						res.finish(err, files);
					}
				});
			}
		});
	}

});