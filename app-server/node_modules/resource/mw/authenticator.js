var HTTP = require('http-status'),
	expandConfig = require('../expandConfig'),
	fn = require('functions');

var authenticator = module.exports = function (config) {
	config = expandConfig(config);
	
	return function (req, res, action, next) {
		var auth = config[action];
		if (auth) {
			if (req.access) {
				if (fn.isString(auth) && !req.access.can[auth]) {
					res.send('Insufficient permissions.', HTTP.FORBIDDEN);
				} else {
					next();
				}
			} else {
				res.send('Not signed in.', HTTP.FORBIDDEN);
			}
		} else {
			next();
		}
	};
};