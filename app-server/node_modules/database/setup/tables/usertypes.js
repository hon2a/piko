var DbTableInitializer = require('../DbTableInitializer'),
	fn = require('functions');

var UsertypesInitializer = module.exports = DbTableInitializer.extend({

	create: function (callback) {
		this.adapter.create({fields: "\
			`id` int(10) unsigned NOT NULL AUTO_INCREMENT,\
			`name` varchar(30) COLLATE utf8_czech_ci NOT NULL,\
			`privileges` int(40) unsigned NOT NULL,\
			PRIMARY KEY (`id`)\
			"}, callback);
	},

	addSuperType: function (callback) {
		this.adapter.insert({
			name: 'SUPER',
			privileges: 4294967295
		}, fn.proxy(function (err, result) {
			if (!fn.handleError(err, 'Cannot insert SUPER usertype.', callback)) {
				this.adapter.update({
					id: 0
				}, {
					id: result.insertId
				}, callback);
			}
		}, this));
	},

	populate: function (callback) {
		this.addSuperType(fn.proxy(function (err) {
			if (!fn.handleError(err, callback)) {
				this.adapter.insertMore([{
					name: 'guest',
					privileges: 0
				}], callback)
			}
		}, this));
	}

});